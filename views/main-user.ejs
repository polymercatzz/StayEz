ั<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>main-user</title>
    <!-- search -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=search" />
    <link rel="stylesheet" href="../css/main-user.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Afacad+Flux:wght@100..1000&family=Concert+One&family=DM+Serif+Text:ital@0;1&family=Exo+2:ital,wght@0,100..900;1,100..900&family=Hind+Mysuru:wght@300;400;500;600;700&family=Inconsolata:wght@200..900&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Itim&family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Marcellus&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=PT+Sans+Caption:wght@400;700&family=Signika+Negative:wght@300..700&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <!-- arrow -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" />

    <!-- link swiperjs -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <!-- close icon -->
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" /> -->

</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <img src="../img/logo.jpeg" alt="" class="pic">
            <div class="stayEz">StayEz</div>
        </div>
        <div class="menu-toggle" id="menuToggle">☰</div>
        <ul class="nav-links" id="navLinks">
            <li><a href="/user/main">Home</a></li>
            <li><a href="/user/history">History</a></li>
            <li><a href="/user/payment">Payment</a></li>
            <li><a href="#footer">Contact</a></li>
            <li><a href="#"class="hidden">Wish list</a></li>
            <li><a href="#" class="hidden" onclick="openPopup()">Profile</a></li>
            <li><a href="main-regis.html"class="hidden">Log out</a></li>
            <li><a href="/user/fav"><img src="../img/heart.png" alt="" class="pic2"></a></li>
            <li><a href="#" onclick="openPopup()"><img src="../img/user.png" alt="" class="pic3"></a></li>        
        </ul>
    </nav>

    <div class="slider-container">
        <div class="slider">
            <div class="slide"><img src="/img/0condo.jpg" alt="Image 1"></div>
            <div class="slide"><img src="/img/1condo.webp" alt="Image 2"></div>
            <div class="slide"><img src="/img/2condo.jpg" alt="Image 3"></div>
            <div class="slide"><img src="/img/3condo.jpg" alt="Image 4"></div>
            <div class="slide"><img src="/img/4condo.jpg" alt="Image 5"></div>
            <div class="slide"><img src="/img/5condo.jpg" alt="Image 6"></div>

        </div>
        <button class="prev" onclick="prevSlide()">&#10094;</button>
        <button class="next" onclick="nextSlide()">&#10095;</button>
    </div>

    <section class="searchall">
        <form action="/user/main" method="GET">
            <div class="search">
                <div class="place">
                    <label for="allplace" class="text">ตำแหน่ง</label>
                    <select id="allplace" name="location" class="allplace">
                        <option value="">ที่พักทั้งหมด</option>
                        <% dept.forEach((d) => { %>
                            <option value="<%= d.department_id %>" <%= filters.location == d.department_id ? 'selected' : '' %>>
                                <%= d.department_name %>
                            </option>
                        <% }) %>
                    </select>        
                </div>
    
                <div class="place">
                    <label for="search" class="text">ประเภทห้องพัก</label>
                    <div class="dropdown">
                        <div class="dropdown-toggle">เลือกประเภทห้องพัก</div>
                        <div class="dropdown-menu">
                            <label>
                                <input type="checkbox" name="roomType" value="pets"
                                    <%= filters.roomType.includes("pets") ? 'checked' : '' %>> ที่พักเลี้ยงสัตว์ได้
                            </label>
                            <label>
                                <input type="checkbox" name="roomType" value="wifi"
                                    <%= filters.roomType.includes("wifi") ? 'checked' : '' %>> Wi-Fi
                            </label>
                            <label>
                                <input type="checkbox" name="roomType" value="tv"
                                    <%= filters.roomType.includes("tv") ? 'checked' : '' %>> TV
                            </label>
                            <label>
                                <input type="checkbox" name="roomType" value="aircon"
                                    <%= filters.roomType.includes("aircon") ? 'checked' : '' %>> Air Conditioner
                            </label>
                            <label>
                                <input type="checkbox" name="roomType" value="washing"
                                    <%= filters.roomType.includes("washing") ? 'checked' : '' %>> Washing Machine
                            </label>
                            <label>
                                <input type="checkbox" name="roomType" value="gym"
                                    <%= filters.roomType.includes("gym") ? 'checked' : '' %>> Fitness
                            </label>
                            <label>
                                <input type="checkbox" name="roomType" value="furniture"
                                    <%= filters.roomType.includes("furniture") ? 'checked' : '' %>> Furniture
                            </label>
                            <label>
                                <input type="checkbox" name="roomType" value="fridge"
                                    <%= filters.roomType.includes("fridge") ? 'checked' : '' %>> Fridge
                            </label>
                            <label>
                                <input type="checkbox" name="roomType" value="security"
                                    <%= filters.roomType.includes("security") ? 'checked' : '' %>> Security Camera
                            </label>
                            <label>
                                <input type="checkbox" name="roomType" value="lift"
                                    <%= filters.roomType.includes("lift") ? 'checked' : '' %>> Lift
                            </label>
                            <label>
                                <input type="checkbox" name="roomType" value="microwave"
                                    <%= filters.roomType.includes("microwave") ? 'checked' : '' %>> Microwave
                            </label>
                            <label>
                                <input type="checkbox" name="roomType" value="parking"
                                    <%= filters.roomType.includes("parking") ? 'checked' : '' %>> Parking
                            </label>
                        </div>
                        
                    </div>
                </div>
    
                <div class="place">
                    <label for="allplace" class="text">ช่วงราคา</label>
                    <select id="allplace" name="price" class="allplace">
                        <option value="">ราคาทั้งหมด</option>
                        <% ["1000-3000", "3000-6000", "6000-9000", "9000-12000", "12000-15000", "15000-18000", "18000-21000", "21000-24000", "24000-27000", "27000-30000"].forEach(price => { %>
                            <option value="<%= price %>" <%= filters.price == price ? 'selected' : '' %>><%= price %></option>
                        <% }) %>
                    </select>        
                </div>
    
                <div class="place">
                    <button type="submit" class="searchbutton">
                        <span class="material-symbols-outlined">search</span>
                    </button>
                </div>
            </div>
        </form>
    </section>
    <div class="allroom">
    <% dept.forEach((data) => { %>
        <% if (!filters.location || filters.location == data.department_id) { %>
            <section class="allroom3">
                <div class="text2">
                    <p><%= data.department_name %> resident</p>
                    <a href="/user/department/<%=data.department_id %>" class="end" id="openLink" target="_blank">
                        <button class="card-button material-icons-outlined">arrow_forward</button>
                    </a>
                </div>
    
                <div class="container swiper">
                    <div class="card-wrapper">
                        <ul class="card-list swiper-wrapper">
                            <% room.forEach((room) => { %>
                                <% if (data.department_id == room.department_id) { %>
                                    <li class="card-item swiper-slide">
                                        <a href="/user/room-details/<%=room.room_id %>" class="card-link">
                                            <p class="badge"><%= data.department_name %> resident</p>
                                            <% const roomImage = img.find(image => image.room_id === room.room_id); %>
                                            <img src="/room_img/<%= roomImage ? roomImage.room_img_id : 'default.jpg' %>" alt="Room Image" class="card-img">
                                            <% let avgRating = review[room.room_id] ? review[room.room_id].avgRating : 0; %>
                                            <p class="card-title">รีวิว <%= avgRating %></p>
                                            <p class="card-title"><%= room.price %> บาท/เดือน</p>
                                            <p class="card-title"><%= room.bedroom %> ห้องนอน</p>
                                            <% const roomHave = JSON.parse(room.room_have); %>
                                            <div class="service">
                                                <% if (roomHave.air_conditioner) { %>
                                                    <img src="/img/air-conditioner.png" alt="Air" class="pic4">
                                                <% } %>
                                                <% if (roomHave.wi_fi) { %>
                                                    <img src="/img/wifi.png" alt="Wi-Fi" class="pic4">
                                                <% } %>
                                                <% if (roomHave.TV) { %>
                                                    <img src="/img/television.png" alt="TV" class="pic4">
                                                <% } %>
                                                <% if (roomHave.washing_machine) { %>
                                                    <img src="/img/washing-machine.png" alt="Washing Machine" class="pic4">
                                                <% } %>
                                                <% if (roomHave.fitnaess) { %>
                                                    <img src="/img/gym.png" alt="Fitness" class="pic4">
                                                <% } %>
                                                <% if (roomHave.furniture) { %>
                                                    <img src="/img/home-furniture.png" alt="Furniture" class="pic4">
                                                <% } %>
                                                <% if (roomHave.pet_friendly) { %>
                                                    <img src="/img/dog.png" alt="Pet Friendly" class="pic4">
                                                <% } %>
                                                <% if (roomHave.fridge) { %>
                                                    <img src="/img/fridge.png" alt="Fridge" class="pic4">
                                                <% } %>
                                                <% if (roomHave.closed_camera) { %>
                                                    <img src="/img/security-camera.png" alt="Closed Camera" class="pic4">
                                                <% } %>
                                                <% if (roomHave.lift) { %>
                                                    <img src="/img/elevator.png" alt="Lift" class="pic4">
                                                <% } %>
                                                <% if (roomHave.microwave) { %>
                                                    <img src="/img/microwave.png" alt="Microwave" class="pic4">
                                                <% } %>
                                                <% if (roomHave.parking) { %>
                                                    <img src="/img/car.png" alt="Parking" class="pic4">
                                                <% } %>
                                            </div>
                                        </a>
                                    </li>
                                <% } %>
                            <% }) %>
                        </ul>
                        <div class="swiper-pagination"></div>
                    </div>
                </div>
            </section>
        <% } %>
    <% }) %>

    <!-- popup -->
    <section>
        <div class="overlay" id="overlay" onclick="closePopup()"></div>

        <div class="popup" id="popup">
            <div class="profile" >
                <div class="close-btn">
                    <button onclick="closePopup()">
                        <img src="../img/close.png" alt="">
                    </button>
                </div>
                <p>Profile</p>
                <div class="allpopupdata">
                    <div class="popupdata">
                        <label for="name">Name:</label>
                        <input type="text" id="firstname" value="<%= user.first_name %>" readonly>
                    </div>
                    <div class="popupdata">
                        <label for="lastname">Lastname:</label>
                        <input type="text" id="lastname" value="<%= user.last_name %>" readonly>
                    </div>
                    <div class="popupdata">
                        <label for="tel">Tel:</label>
                        <input type="text" id="tel" value="<%= user.tel %>" readonly>
                    </div>
                    <div class="popupdata">
                        <label for="email">Email:</label>
                        <input type="text" id="email" value="<%= user.email %>" readonly>
                    </div>
                    <div class="log-out">
                        <br>

                        <a href="/logout"><button><img src="../img/log-out.png" alt=""></button></a>
                    </div>
                </div>
                
            </div>
        </div>

    </section>
    <footer id="footer">
        <div class="footer">
            <div class="footer-content">
            <p>Line: @place1234</p>
            <p>Tel: 000000000</p>
            <p>Email: place@1234.com</p>
            </div>
    </footer>


    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <!--  swiper room -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script>
        // menu
        document.getElementById("menuToggle").addEventListener("click", function() {
            document.getElementById("navLinks").classList.toggle("active");
        });

        document.querySelectorAll(".dropdown-toggle").forEach(item => {
            item.addEventListener("click", function() {
                let dropdownMenu = this.nextElementSibling;
                dropdownMenu.classList.toggle("show");
            });
        });

        document.addEventListener("click", function(event) {
            if (!event.target.closest(".navbar")) {
                document.getElementById("navLinks").classList.remove("active");
                document.querySelectorAll(".dropdown-menu").forEach(menu => menu.classList.remove("show"));
            }
        });


        // sliderpic
        let index = 0;
        const slides = document.querySelectorAll('.slide');

        function showSlide(i) {
            if (i >= slides.length) index = 0;
            if (i < 0) index = slides.length - 1;
            document.querySelector('.slider').style.transform = `translateX(${-index * 100}%)`;
        }

        function nextSlide() {
            index++;
            showSlide(index);
        }

        function prevSlide() {
            index--;
            showSlide(index);
        }

        showSlide(0); 
        setInterval(nextSlide, 3000); 

        // dropdownsearch
        document.querySelector(".dropdown-toggle").addEventListener("click", function() {
            let menu = document.querySelector(".dropdown-menu");
            menu.style.display = menu.style.display === "block" ? "none" : "block";
        });

        document.addEventListener("click", function(event) {
            if (!event.target.closest(".dropdown")) {
                document.querySelector(".dropdown-menu").style.display = "none";
            }
        });

        //swiper room
        new Swiper('.card-wrapper', {
        loop: true,
        grabCursor: true,
        simulateTouch: true,


        // If we need pagination
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
            dynamicBullets: true,
        },

        // Navigation arrows
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },

       

        breakpoints: {
            0: {
                slidesPerView: 1,
                spaceBetween: 20,
            },
            450: {
                slidesPerView: 2,
                spaceBetween: 20,
            },
            768: {
                slidesPerView: 3,
                spaceBetween: 20,
            },
            1024: {
                slidesPerView: 4,
                spaceBetween: 20,
            },
            
        },
});

    // open link new tab
    document.addEventListener("keydown", function(event) {
        if (event.key === "a" || event.key === "A") {
            event.preventDefault(); // ป้องกันการเปลี่ยนหน้าเว็บหลัก
            document.getElementById("openLink").click();
        }
    });



    // popup
    function openPopup() {
        popup.classList.add("openPopup");
        document.getElementById("overlay").classList.add("active");


                }

    function closePopup() {
        popup.classList.remove("openPopup");
        document.getElementById("overlay").classList.remove("active");

                }


    </script>
</body>
</html>